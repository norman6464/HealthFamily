# HealthFamily - 今お薬飲んでよ通知アプリ

> 家族もペットも、みんなの健康をキャラクターと一緒に守る服薬管理アプリ

---

## 目次

- [概要](#概要)
- [技術スタック](#技術スタック)
- [セットアップ](#セットアップ)
- [ターゲットユーザー](#ターゲットユーザー)
- [主要機能一覧](#主要機能一覧)
- [キャラクターシステム](#キャラクターシステム)
- [通知システム設計](#通知システム設計)
- [開発ルール](#開発ルール)

---

## 概要

**「今お薬飲んでよ通知アプリ」** は、自分だけでなく家族やペットの服薬を一括管理できるヘルスケアアプリケーションです。

設定したアテンドキャラクター（犬・猫・うさぎ・インコ）が服薬時間を可愛くお知らせし、飲み忘れ防止をサポートします。

---

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | Next.js 15 (App Router) |
| 言語 | TypeScript |
| データベース | PostgreSQL |
| ORM | Prisma |
| 認証 | NextAuth.js v5 (Auth.js) - Credentials Provider |
| スタイリング | Tailwind CSS |
| アイコン | lucide-react |
| 状態管理 | Zustand（キャラクター選択） |
| バリデーション | Zod |
| テスト | Vitest + React Testing Library |
| デプロイ | Vercel |
| CI | GitHub Actions |

### アーキテクチャ

クリーンアーキテクチャを採用し、以下のレイヤーに分離しています。

```
src/
├── domain/          # エンティティ、リポジトリインターフェース、ユースケース
├── data/            # APIクライアント、リポジトリ実装
├── presentation/    # カスタムフック（ViewModel）
├── components/      # UIコンポーネント
├── app/             # Next.js App Router（ページ、APIルート）
├── lib/             # Prisma、NextAuth設定、Zodスキーマ
├── stores/          # Zustandストア
├── hooks/           # 共通フック
└── infrastructure/  # DIコンテナ
```

---

## セットアップ

### 前提条件

- Node.js 20以上
- PostgreSQL

### インストール

```bash
# 依存関係インストール
npm install

# 環境変数設定
cp .env.local.example .env.local
# .env.local を編集してデータベースURLとシークレットを設定

# データベース作成・マイグレーション
npx prisma migrate dev

# 開発サーバー起動
npm run dev
```

### 開発コマンド

```bash
npm run dev       # 開発サーバー起動
npm run build     # 本番ビルド
npm run lint      # リント実行
npx vitest run    # テスト実行
```

---

## ターゲットユーザー

### プライマリターゲット

| 対象 | 詳細 |
|------|------|
| 介護者の方 | 離れて暮らす祖父母・両親の服薬状況を見守りたい方 |
| 子育て世代 | 子どもの服薬・ワクチン管理をしたい保護者 |
| ペットオーナー | フィラリア・ノミダニ予防薬など、ペットの投薬管理が必要な方 |

### セカンダリターゲット

| 対象 | 詳細 |
|------|------|
| 健康意識が高い方 | サプリメント管理、栄養管理、運動管理をしたい方 |
| 頓服薬を使う方 | 頭痛薬など不定期な服薬の記録・間隔管理をしたい方 |
| 多頭飼いの飼い主 | 複数のペットの通院・投薬を管理したい方 |

---

## 主要機能一覧

### 1. 服薬管理（人間）

- 毎日のお薬・サプリメントの登録とリマインダー通知
- 頓服薬（頭痛薬など）のイレギュラー登録
  - 服薬時刻の記録
  - 次回服薬可能時刻の通知（例：「次は4時間後に服用可能です」）
- お薬の種類管理（家族メンバーごとに誰が何の薬を飲んでいるか）
- お薬の残数管理 → 残数が少なくなると病院予約リマインダーを表示
- 服薬完了記録

### 2. 服薬管理（ペット）

- プロフィール写真登録
- 通常のお薬（複数管理・項目追加可能）
- ノミダニ予防薬管理
- フィラリア薬管理
- サプリメント管理
- お薬残量管理 → 次回通院予約リマインダー

### 3. 通院・医療記録

- 通院日登録（人間・ペット共通）
- ワクチン接種日登録 → 次回接種日リマインダー
- 既往歴登録
  - 持病
  - 過去の大きな病気
  - 入院・手術歴
  - アレルギー有無
  - 薬の副作用記録
- かかりつけ病院登録（複数可）
- 検査結果登録
- 費用登録
- 健康診断リマインダー

### 4. 栄養管理

- ご飯の記録
- 栄養素の計算
- 今日何を食べたらいいかの提案

### 5. 運動管理

- お散歩記録
- ストレッチ記録
- ランニング記録
- 運動達成度に応じたキャラクターのリアクション

### 6. ダッシュボード機能

- **今日の服薬スケジュール表示**
  - 時系列順のスケジュール一覧表示
  - 服薬時刻、お薬名、対象者（家族・ペット）の表示
  - ステータス管理（未服薬/服薬済み/時間超過）
  - メンバータイプ別アイコン表示（人間・ペット）
  - レスポンシブデザイン対応
  - アクセシビリティ対応（ARIA属性）
  - ローディング状態・空状態の適切な表示

### 7. キャラクター（アテンド）システム

- 選択可能なキャラクター：犬、猫、うさぎ、インコ
- 服薬時間の通知（にゃいにゃい）
- 飲み忘れ時の再通知（びゃいびゃい）
- 服薬完了時の鳴き声（音声再生）
- 運動達成時のリアクション

---

## キャラクターシステム

### キャラクター定義

| キャラクター | 通常鳴き声 | 服薬通知 | 飲み忘れ通知 | 服薬完了 | 運動応援 |
|------------|-----------|---------|------------|---------|---------|
| いぬ | わんわん | わんわん！お薬の時間だよ！ | きゃいんきゃいん！お薬忘れてるよ！ | わん！えらい！ | わんわん！すごいね！ |
| ねこ | にゃいにゃい | にゃいにゃい！お薬の時間にゃ！ | びゃいびゃい！お薬飲んでにゃ！ | にゃ〜ん♪ | にゃいにゃい！頑張ったにゃ！ |
| うさぎ | ぴょんぴょん | ぴょんぴょん！お薬の時間だよ！ | ぶぅぶぅ！お薬忘れてるよ！ | ぴょん♪ | ぴょんぴょん！えらいね！ |
| インコ | ぴーぴー | ぴよぴよ！お薬の時間だよ！ | ぎゃーぎゃー！お薬飲んで！ | ぴー♪ | ぴよぴよ！すごい！ |

### キャラクターの感情状態

```typescript
type CharacterMood =
  | 'happy'       // 服薬完了・運動達成時
  | 'excited'     // 大きな達成時
  | 'normal'      // 通常状態
  | 'reminding'   // 服薬時間通知中
  | 'worried'     // 飲み忘れ検知時
  | 'sad'         // 長期間の飲み忘れ
  | 'cheering';   // 運動応援中
```

---

## 通知システム設計

### 通知種類

| 通知種類 | トリガー | キャラクター反応 | 優先度 |
|---------|---------|-----------------|-------|
| 服薬リマインダー | スケジュール時刻 | 「にゃいにゃい」(設定キャラの鳴き声) | 高 |
| 飲み忘れアラート | 服薬時刻超過15分後 | 「びゃいびゃい」(緊急鳴き声) | 最高 |
| 頓服薬服用可能通知 | 前回服用から指定時間経過 | 通常鳴き声 | 中 |
| 残数アラート | 残数が閾値以下 | 「病院行こうにゃい」 | 中 |
| 通院リマインダー | 予約日の前日/当日 | 「病院の日だにゃい」 | 高 |
| ワクチンリマインダー | 次回接種日の1週間前 | 「注射の日が近いにゃい」 | 中 |
| 健康診断リマインダー | 設定日の1週間前 | 「健康診断だにゃい」 | 中 |

---

## 開発ルール

### ブランチ戦略

```
main (本番)
  └── develop (開発)
       ├── feature/機能名    # 新機能開発
       ├── fix/バグ名        # バグ修正
       └── docs/ドキュメント名 # ドキュメント更新
```

### コミットメッセージ規則

```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: コードスタイル変更（動作に影響なし）
refactor: リファクタリング
test: テスト追加・修正
chore: ビルド・設定変更
```

### PR ルール

- PRタイトルはコミットメッセージ規則に従う
- PR本文には変更内容・影響範囲・テスト方法を記載
- レビュー承認後にマージ
